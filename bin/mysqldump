#!/bin/bash
project=$(pwd | sed "s|$HOME/Sites/||" | cut -d'/' -f1)

# Try project-specific, fallback to default
if docker ps --format '{{.Names}}' | grep -q "^mariadb-${project}$"; then
    container="mariadb-$project"
elif docker ps --format '{{.Names}}' | grep -q "^postgres-${project}$"; then
    docker exec -i "postgres-$project" pg_dump -U root "$@"
    exit $?
else
    container="mariadb"
fi

docker exec -uroot -i -w "/var/www/$project" "$container" mysqldump "$@"
